@use 'breakpoints' as bp;

// =============================================================================
// Grid Area Assignments
// =============================================================================

.video {
  grid-area: video;
  display: flex;
}
.upper-middle-1 {
  grid-area: upper-middle-1;
}
.upper-middle-2 {
  grid-area: upper-middle-2;
}
.upper-middle-3 {
  grid-area: upper-middle-3;
}
.upper-right-1 {
  grid-area: upper-right-1;
}
.upper-right-2 {
  grid-area: upper-right-2;
}
.upper-right-3 {
  grid-area: upper-right-3;
}
.gutter {
  grid-area: gutter;
}
.grid-bottom {
  grid-area: bottom;
}

// =============================================================================
// 1. Base — Mobile Portrait (single column, panels hidden)
// =============================================================================

.page {
  display: grid;
  height: calc(100vh - #{bp.$nav-height});
  gap: bp.$gap;
  overflow: hidden;

  grid-template-columns: 1fr;
  grid-template-rows: auto 1fr;
  grid-template-areas:
    'video'
    'bottom';
}

.video {
  width: 100%;
}

.panel,
.gutter,
.resizer {
  display: none;
}

// =============================================================================
// 2. Tablet (min-width: 769px)
// Video full-width top, panels hidden, grid-bottom bottom
// =============================================================================

@include bp.tablet {
  .page {
    grid-template-columns: 1fr;
    grid-template-rows: auto minmax(#{bp.$min-grid-height}, 1fr);
    grid-template-areas:
      'video'
      'bottom';
  }

  .video {
    width: 100%;
  }

  .gutter,
  .resizer {
    display: none;
  }
}

// =============================================================================
// 3. Desktop (min-width: 1180px)
// 4-column layout, all panels visible, resizer visible
// =============================================================================

@include bp.desktop {
  .page {
    // 100% = container width (not viewport — accounts for sidenav)
    // 600px = minmax(360px) + 200px + 40px (minimum width of columns 2–4)
    --actual-video-width: min(
      var(--video-width, 640px),
      calc(100% - 600px),
      calc((100vh - #{bp.$nav-height} - #{bp.$min-grid-height}) * 16 / 9)
    );

    grid-template-columns: var(--actual-video-width) minmax(360px, 1fr) 200px 40px;
    grid-template-rows: 60px 60px auto minmax(#{bp.$min-grid-height}, 1fr);
    grid-template-areas:
      'video  upper-middle-1  upper-right-1  gutter'
      'video  upper-middle-2  upper-right-2  gutter'
      'video  upper-middle-3  upper-right-3  gutter'
      'bottom bottom          bottom         bottom';
  }

  .video {
    width: auto;
  }

  .panel {
    display: block;
  }

  .panel.upper-right-1 {
    display: flex;
  }

  .gutter {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .resizer {
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: visible;
  }
}

// =============================================================================
// 4. Ultrawide (min-aspect-ratio: 2/1 + min-width: 1180px)
// Video full height, grid-bottom beside video
// =============================================================================

@include bp.ultrawide {
  .page {
    --actual-video-width: min(
      var(--video-width, 640px),
      calc(100% - 600px),
      calc((100vh - #{bp.$nav-height}) * 16 / 9)
    );

    grid-template-rows: 60px 60px auto minmax(#{bp.$min-grid-height}, 1fr);
    grid-template-areas:
      'video  upper-middle-1  upper-right-1 gutter'
      'video  upper-middle-2  upper-right-2 gutter'
      'video  upper-middle-3  upper-right-3 gutter'
      'video  bottom          bottom        bottom';
  }

  .video {
    aspect-ratio: auto;
    align-items: center;
    justify-content: center;

    video {
      max-height: 100%;
      aspect-ratio: 16 / 9;
    }
  }
}

// =============================================================================
// 5. Mobile Landscape (max-height: 480px + landscape)
// LAST so it overrides everything — video fullscreen, all else hidden
// =============================================================================

@include bp.mobile-landscape {
  .page {
    height: 100vh;
    grid-template-columns: 1fr;
    grid-template-rows: 1fr;
    grid-template-areas: 'video';
  }

  .video {
    width: 100%;
    aspect-ratio: auto;
    align-self: stretch;
  }

  .panel,
  .panel.upper-right-1,
  .grid-bottom,
  .resizer {
    display: none;
  }
}
